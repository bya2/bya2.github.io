---
title: \[Passport\] Passport

categories:
  - Node.js
tags:
  - [Node.js, OAuth, Passport, Strategies]

toc: true
toc-sticky: true

date: 2021-09-05
last_modified_at: 2021-09-05
---

이전에 공부했었던 Passport에 대한 정리와 구현

# 개요

 기업들은 자사의 서비스 데이터를 읽어갈 수 있도록 하는 API를 공개했고, 이를 이용한 많은 모바일 앱들이 등장했습니다. 예를 들어, 트위터를 이용하는 이용자들은 자신의 개성에 따라 트위터를 이용할 수 있게 되었습니다.  
 이로 인해 많은 기업들이 자사의 데이터를 외부에서 접속해서 사용할 수 있도록 공개하기 시작했습니다.

 문제는 '인증'이었습니다. 자사의 데이터를 가져가게 하려면 사용자의 허가가 필요한데, 이를 위해서는 사용자의 계정과 비밀번호가 필요했습니다.

 이를 극복하기 위해서, 정보 기술 업계에서는 OAuth, OpenID와 같은 표준화 방법을 고안하기 시작했습니다. 이와 같은 방법을 이용하면 사용자의 비밀번호를 제 3의 서비스에게 노출시키지 않고도 인증 기능을 구현할 수 있기 때문입니다.  
 즉, 제 3의 서비스에게 모든 권한을 주지않고 필요한 최소한의 권한만을 부여해서 최악의 보안 사고를 막을 수 있는 안전장치를 마련할 수 있게 됬습니다.

 그 후로 다양한 로그인 방법들이 생겨났습니다. 예를 들어, 페이스북, 구글, 카카오톡 등...

 그러나 이러한 인증 방법을 안전하게 구현하는 것은 매우 어려운 일입니다.  
 이런 맥락에서 Express 프레임워크에서 등장한 라이브러리가 바로 Passport입니다. Passport는 현 시점에서 약 300가지의 인증 방법은 'Strategy'이라는 이름으로 제공하고 있습니다. 전략을 추가하는 것만으로도 복잡한 인증 방법을 손쉽게 구현해낼 수 있게 되었습니다. Web4, express-session, auth 등 이러한 인증 기능을 Passport로 전환하는 작업을 지금부터 시작합니다.

 내부적으로는 Session을 사용합니다. 따라서 express-session을 활성화시키는 코드 다음에 passport가 등장해야합니다.

# 인증 구현

login form에서 전송한 데이터를 passport가 받도록 하고, 그 때 주소(route)로 전송되는 데이터는 Local strategy(id, pw)를 통해 로그인하는 전략으로 처리합니다.  
그래서 성공했을 때는 '/'로, 실패했을 때는 다시 '/auth/login'으로 보내겠다는 의도가 담겨있는 코드 부분을 작성합니다.

이제 사용자가 실제 이 서비스의 owner 인지 아닌지를 확인하는 로그인 로직이 필요합니다. (=> 자격확인)

# 자격 확인

사용자가 로그인 했을 때, 로그인에 성공했는지, 실패했는지 자격확인을 할 필요가 있습니다.
```js
passport.use(전략)
```

# 세션 이용

`app.use`는 `express`에 미들웨어를 설치하는 메서드입니다.

자격 확인을 위해서 `passport`가 `express`에 설치되어있어야합니다. = `initialize`

`passport`를 사용하면서 `session`을 내부적으로 사용해야합니다. = `session`

이런 상태에서 로그인을 하면 성공할 수 있습니다!  
하지만 사용자에 대한 정보를 세션으로 저장해야하는데, 세션에 대한 설정이 되어있지 않습니다.

Passport는 내부적으로 세션을 이용해야합니다. 따라서 세션을 처리할 방법이 필요합니다. = `serializeUser`, `deserializeUser`

